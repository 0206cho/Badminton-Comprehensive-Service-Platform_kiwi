<!DOCTYPE html>
<!-- marketEdit -->
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layouts/layout1}">

<!-- 사용자 스크립트 추가 -->
<th:block layout:fragment="script">

	<script th:inline="javascript">
        $(document).ready(function(){
            var errorMessage = [[${errorMessage}]];
            if(errorMessage != null){
                alert(errorMessage);
            }

            bindDomEvent();

        });
    </script>

</th:block>

<!-- 사용자 CSS 추가-->
<th:block layout:fragment="css">
	<link
		href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
		rel="stylesheet"
		integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
		crossorigin="anonymous">

	<style>
.content {
	display: flex;
	flex-direction: column;
	align-items: center;
	margin-left: 15%;
	margin-right: 15%;
}

.edit {
	display: flex;
	flex-direction: column;
	align-items: left;
	margin-left: 15%;
	margin-right: 15%;
}

.fieldError {
	color: #bd2130;
}

a {
	text-decoration: none;
}

.head { /*지역, 도시, 검색창, 글쓰기 버튼*/
	display: flex;
	align-items: center;
	gap: 5px;
	margin-bottom: 50px;
}

.btn-kiwi {
	background-color: #70ACB1;
	color: white;
	border-color: #666;
}

.btn-kiwi:hover {
	color: white;
	background-color: #70ACB1;
	border-color: #7cc
}

.btn-cancel {
	background-color: #D5D5D5;
	color: black;
	border-color: #666;
}

.btn-cancel:hover {
	background-color: #D5D5D5;
	color: black;
	border-color: #7cc;
	color: black;
}

.ck-editor__editable {
	height: 400px;
	width: 100%;
}

.modal-dialog {
	width: 300px;
	height: 300px;
}

.ck.ck-editor {
	max-width: 800px;
}

.ck-editor__editable {
	min-height: 800px;
}
</style>
</th:block>

<!-- 사용자 스크립트 추가 -->
<th:block layout:fragment="script">
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
		crossorigin="anonymous"></script>
	</style>
</th:block>


<div layout:fragment="content">
	<form id ="frm" role="form" method="post" enctype="multipart/form-data" th:action="'/market/marketUpdate/' + ${market.id}" >

		<div class="head">
			<!--지역 -->
			<select class="select" name="region"
				style="padding: 6px; margin-right: 20px;">
				<option value="region" selected>지역</option>
				<option value="0">서울특별시</option>
				<option value="1">부산광역시</option>
				<option value="2">대구광역시</option>
				<option value="3">인천광역시</option>
				<option value="4">광주광역시</option>
				<option value="5">대전광역시</option>
				<option value="6">울산광역시</option>
				<option value="7">세종특별시</option>
				<option value="8">경기도</option>
				<option value="9">강원도</option>
				<option value="10">충청북도</option>
				<option value="11">충청남도</option>
				<option value="12">전라북도</option>
				<option value="13">전라남도</option>
				<option value="14">경상북도</option>
				<option value="15">경상남도</option>
				<option value="16">제주도</option>
			</select>

			<!--도시 -->
			<select class="select" name="region"
				style="padding: 6px; margin-right: 120px;">
				<option value="city" selected>도시</option>
				<option value="0">서울특별시</option>
				<option value="1">부산광역시</option>
				<option value="2">대구광역시</option>
				<option value="3">인천광역시</option>
				<option value="4">광주광역시</option>
				<option value="5">대전광역시</option>
				<option value="6">울산광역시</option>
				<option value="7">세종특별시</option>
				<option value="8">경기도</option>
				<option value="9">강원도</option>
				<option value="10">충청북도</option>
				<option value="11">충청남도</option>
				<option value="12">전라북도</option>
				<option value="13">전라남도</option>
				<option value="14">경상북도</option>
				<option value="15">경상남도</option>
				<option value="16">제주도</option>
			</select> <input type="number" th:value="{market.price}" class="form-control"
				style="width: 50%; height: 36px;" placeholder="가격을 입력해주세요.">
			<!--  
			<p th:if="${#fields.hasErrors('price')}" th:errors="*{price}"
				class="fieldError">Incorrect data</p>
				-->
			<button type="button" class="btn btn-cancel" style="width: 120px;" onclick="location.href='marketEdit'">취소</button>
			<div th:if="${#strings.isEmpty(marketDto.id)}" style="text-align: center">
				<button type="submit" id="edit" class="btn btn-kiwi" style="width: 100px;">수정</button>
				<!-- <button type="submit" id="delete" class="btn btn-kiwi" style="width: 100px;">삭제</button> -->
				<!--  data-bs-toggle="modal" data-bs-target="#exampleModal" -->
				<!-- th:formaction="@{/admin/market/new}"  -->
			</div>
		</div>
		<input type="hidden" th:value="${market.id}">
		<div class="edit">
			<div class="row">

				<textarea th:value="${market.title}"" class="form-control" cols="80px"
					style="width: 98%; height: 36px; border-style: none; font-weight: bold; font-size: x-large; margin-left: 10px;"
					placeholder="제목을 입력해주세요."></textarea>
			</div>

			<hr>
			<h5>대표이미지를 선택해주세요.</h5>
			<label class="custom-file-label" data-browse="Browse"></label><br> 
			<input type="file" class="file-input files" name="file" id="file"> <br>
			<!-- <img th:src="${vo.filepath}" id="previewImg" width="700" alt="대표이미지"/> -->
			<br>
			<hr>


			<textarea th:value="${market.detail}" name="text" id="editor"
				placeholder="내용을 입력해주세요."></textarea>


		</div>

		<input type="hidden" name="_csrf" id="_csrf" th:value="${_csrf.token}">



	</form>
	<script
		src="https://cdn.ckeditor.com/ckeditor5/34.0.0/classic/ckeditor.js"></script>
	<script
		src="https://cdn.ckeditor.com/ckeditor5/34.0.0/classic/translations/ko.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<!-- jQuery사용하기 위한 라이브러리 추가 -->
	<script>
	const $ckUploadPath = "/image/upload?_csrf=" + $('#_csrf').val();
			ClassicEditor.create(document.querySelector('#editor'), {
				ckfinder: {
					uploadUrl : $ckUploadPath
				}
			})
			.then(editor => {
				console.log('Editor was initialized');
			})
			.catch(error => {
				console.error(error);
			});
			
	// 대표이미지 띄어주기
	const fileInput = document.getElementById("file");
	const handleFiles = (e) => {
			const selectedFile = [...fileInput.files];
			  const fileReader = new FileReader();

			  fileReader.readAsDataURL(selectedFile[0]); // 특정 파일 읽기

			  fileReader.onload = function () {
			    document.getElementById("previewImg").src = fileReader.result;
			    // 파일 내용 img태그의 src로 돌려줌
			  };
	};

	fileInput.addEventListener("change", handleFiles);
	
	$(document).ready(function(){
        $("#edit").on("click", function(){
            var frm = $("#frm")[0];
            frm.action = "/market/marketUpdate";
            frm.submit();
        });

        $("#delete").on("click", function(){
            var frm = $("#frm")[0];
            frm.action = "/market/marketDelete";
            frm.submit();
        });
    })
		
		</script>

	<!--서버 추가하기 모달창-->
	<div class="modal fade" id="exampleModal" tabindex="-1"
		aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content">
				<div class="modal-body">
					<div class="mb-3">
						<p>
						<div
							style="text-align: center; font-weight: bold; font-size: x-large;">글쓰기
							완료</div>
						<br>
						<div style="text-align: center;">
							<button class="btn btn-kiwi" onclick="location.href='market'">확인</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
</html>